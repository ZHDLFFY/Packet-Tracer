<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <title>Document</title>
    <style>
        table {
            border: 2px solid black;
            width: 100%;
            height: 200%;
            position: relative
        }
        
        tbody,
        th,
        td {
            border: 1px solid black;
            height: 50px;
            ;
        }
        
        input {
            color: black;
            width: 100%;
            height: 50px;
            ;
        }
        
        .All {
            width: 30%;
            padding: 10px;
            border: 2px solid rgb(155, 155, 150);
            background-color: rgb(233, 233, 224);
            box-shadow: 10px 15px 10px rgb(121, 118, 118);
            position: absolute;
            left: 20%;
            top: 10%;
        }
        
        img {
            width: 65px;
            height: 55px;
        }
    </style>

</head>

<body>

    <div class="All">
        <table>
            <tr>
                <th>id</th>
                <th>ststus</th>
                <th>custom_status</th>
            </tr>
            <tbody id="fromServe"></tbody>
        </table>

        <div style="width: 100%;margin-top: 20px;">
            <button onclick="insertInto()" class="btn btn-success">添加id</button>
            <input type="text" id="ledid" class="form-control" placeholder="例如 001" style="float: right;width: 50%;">
        </div>


    </div>
    <script>
        window.onload = init();

        function init() {
            Flogin();
        }


        function Flogin() {

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText) //后台返回的数据
                    const result = JSON.parse(this.responseText); //将一个JSON字符串转化为对象


                    let str = `<tr><td>` + result.id + `</td>`
                    str += `<td>`
                    if (result.status == 0) {
                        str += `<img src="./led1.gif" id="L1" >`;

                    } else {
                        str += `<img src="./led2.gif"  id="L1" > `;

                    }
                    str += ` </td>`

                    str += `<td>`
                    if (result.customer_status == 0) {
                        str += `<input type="button"  onclick="CloseSwitch()" value="开" id="RCS0">`
                    } else {
                        str += `<input type="button"  onclick="CloseSwitch()" value="关" id="RCS0">`
                    };
                    str += `</td>`
                    str += `</tr>`


                    console.log(str);

                    document.getElementById(`fromServe`).innerHTML = str;
                }
            };
            xhttp.open("GET", "led/001", true);
            xhttp.send();

        }



        let i = 1;

        function CloseSwitch() {
            if (i % 2 == 0) {
                turnon(0);
                i++;
            } else {
                turnon(1);
                i++;
            }
        }

        function turnon(status) {

            let R0 = document.getElementById('RCS0');
            let L1 = document.getElementById('L1');
            //  confirm(L1.value);
            if (R0.value == "开") {
                R0.value = "关";
                L1.src = "./led2.gif";
            } else {
                R0.value = "开";
                L1.src = "./led1.gif";
            }

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText) //后台返回的数据
                    const obj = JSON.parse(this.responseText); //将一个JSON字符串转化为对象

                    if (obj.succ === true) {
                        console.log("更新成功");
                    } else {
                        console.log("更新失败");
                    }
                }
            };

            xhttp.open("post", "led/001/" + status, true);
            xhttp.send();
        }



        function insertInto() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText) //后台返回的数据
                    const obj = JSON.parse(this.responseText); //将一个JSON字符串转化为对象
                    if (obj.succ == true) {
                        console.log("添加成功");
                    } else {
                        console.log("添加失败");
                    }
                }
            };
            let id = document.getElementById('ledid').value;
            xhttp.open("post", "led/" + id, true);
            xhttp.send();
        }
    </script>
</body>

</html>